---
  title: "Key to a Productive Study Session"
  output: 
    flexdashboard::flex_dashboard:
      vertical_layout: fill
      theme:
        version: 4
        bootswatch: cerulean
      orientation: column
      storyboard: true
      self_contained: false
  date: "2023-03-17"
---
  
```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(lubridate)
library(ggplot2)
library(tidyverse)
library(plotly)
library(spotifyr)
library(compmus)
library(dplyr)
library(tidymodels)
library(ggdendro)
library(heatmaply)

lofi <- get_playlist_audio_features("", "1IESTA4eaoYhOAi5d0N5Kz?si=e499e373775e4f71")
s_classic <- get_playlist_audio_features("", "63PWggVCDaRoygnVT6zeot?si=69efc4e73940435b") 
non_lofi <- get_playlist_audio_features("", "66RrIu8zXbf3NiDX07e28Z?si=1cd6a16fe1c84826") 
futurefunk <- get_playlist_audio_features("", "5j5HRbB3Qy0GPGVbCrKP2G?si=91fbd0c8c6254fc6")
soft_lofi <-
  bind_rows(
    futurefunk |> mutate(category = "Future Funk"),
    non_lofi |> mutate(category = "Beast Mode"),
    s_classic |> mutate(category = "Soft Classical"),
    lofi |> mutate(category = "Study Lofi")
  ) 
chopin <-
  get_tidy_audio_analysis("40pgdwioxZSCUyCke0zzOp?si=c5c8c0e45dd54c76") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches) #'Nocturne in A-Flat Major, Op. 32, No. 2' by Chopin
ludovico <-
  get_tidy_audio_analysis("3weNRklVDqb4Rr5MhKBR3D?si=3723ad9ebb624e86") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches) #Nuvole Bianche by Ludovico Einaudi
blackpink <-
  get_tidy_audio_analysis("0skYUMpS0AcbpjcGsAbRGj?si=1845018d70214865") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
dualipa <-
  get_tidy_audio_analysis("5nujrmhLynf4yMoMtj8AQF?si=7edf27c3177b417f") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
futurefunk1 <-
  get_tidy_audio_analysis("6lSrgTxyF9XgyLuNByH7Vm?si=e481dedf14de48f0") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
futurefunk2 <-
  get_tidy_audio_analysis("2sj2K4VaNNkW17K1yhgrAm?si=9a95d533438b4ee5") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
lofi1 <-
  get_tidy_audio_analysis("5yzk0dn1DmFcTkon5JrtTc?si=61052cc7cd0741dd") |> # Forgotten Past by Dosi, Wishes and Dreams
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
lofi2 <-
  get_tidy_audio_analysis("6y3y1s6eiTYsLEajJGbCkj?si=2a95b480bd31415c") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches) # Cadenza by Lucid Keys, Mondo Loops
lofi3 <-
  get_tidy_audio_analysis("0UCJtleZmlwpicJkmrys4a?si=8172fd17c8834ca2") |># convo by SNUG
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)
```

Introduction{.storyboard}
=========================================
  
### What features recipe goes into making the best study playlist?

Remember that night where you had study very late night or a weekend full of just reviewing and studying before the exam next week? Many of us can agree to the fact that a "good playlist" can *boost the mood of any study or work session*. "Good playlist" can be like a breath of fresh air when you are reaching the limit for that day and don't feel as *productive* anymore to get tasks and to-do list done. [Research #1](https://eric.ed.gov/?id=ED478771) has shown that soft music makes them feel comfortable, focused, and relaxed by perfectly building the environment to study (Dinsmore, 2003, p. 19).

Adrian Low, a chartered psychologist who specialises in stress research, tells how certain music genres can help people de-stress as well as set the tone for better concentration. The psychologist suggested choosing songs between *60 to 70 beats per minute (bpm)*, such as jazz, and avoiding those with jarring sounds or sudden changes in tempo.Language plays a part too. It can actually be distracting if a song is in a language that we understand because we will be drawn into the music

However, [another research](https://content.iospress.com/articles/work/wor01141) has shown that background music influences listener attention. This influence has more to do with listener fondness for the music than with type of music. Compared to situations without background music, the likelihood of background music affecting test-taker attention performance is likely to increase with the degree to which the test-taker likes or dislikes the music. (Huang, Rong-Hwa, 2011). Similar results were received by a [research conducted by Cardiff Metropolitan University](https://onlinelibrary-wiley-com.ezp1.lib.umn.edu/doi/pdf/10.1002/acp.2994) that showed if people listen to songs they dislike, it decreases productivity. Surprisingly, grooving to their favorite tracks can cause them to lose focus, too.
  
We can sum everything up and say that choosing the right music that it is neither liked or disliked can be a challenge and it might be the reasoning why there exists so many study playlists or background music playlists. Therefore following can be the **formula** for figuring out the perfect study playlist for you, first of all, you have to be *neutral* about the playlist. (I know it is hard, but you shouldn't get attached to the playlist). Second of all, *no lyrics* will be better for you. Even though you had a bad day which you wanna sing off, or sing along to boost your mood, low speecheability will be better for you. Lastly, several researches made by psychologists and neuroscientists has recommended certain ranges for certain *features* like tempo. 

In my corpus, I will be testing all these theories and ensirong the accuracy of the secret formula to a productive study session. I will be working with lo-fi beats. Lo-fi, short for ‚Äúlow fidelity‚Äù, describes tracks recorded with flaws such as background noise or sounds like raindrops or soft taps. The music in Lo-fi does not feature lyrics, so it does not take your attention away, especially for those who are reading and writing. To increase the level of precision and accuracy I will be doing a cross playlist analysis of Soft Classical music playlist, Workout playlist and Future Funk playlist. The strategy that will be followed for effective results is visual comparison of the focus playlists which are Lo-fi playlist and Soft-Classical playlist within each other and against the archetypes: Workout and Future Funk (you will be able to learn more about the focus and control playlists on the next tab).

### Focus playlists 

The 4 playlists we are working with have many similarities and many differences.
The *lofi playlist* "Study Lofiüìö" by Lofi Girl is a public playlist that has over 7 million likes on Spotify, **500 songs worth of 20 hr 44 mins** of total listening time. One of the unique features of the playlist is that it gets updated, shuffled, renewed and reorganised every day. It is a collection of chill beats - perfect to help you relax and study. 

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/0vvXsWCC9xrXsKd4FyS8kM?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

The *soft-classical playlist* made by Umut Aytac is a public playlist made a random spotify user which consists of **131 songs worth of 7 hr 45 mins** of listening time. It is a playlist put together by the wide range of musicians starting with Chopin and ending with brilliant modern musicians like Sherwood Roberts. 

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/6d7BJsiKHny0PHvgn62pBU?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

The *workout playlist* "Beast Mode" was created by Spotify and has collected almost 10 million likes. It is a collection of **182 songs worth of 9hr 20 mins** of listening. The playlists gets occasionally updated based on the trending new songs and rankings. 

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DX76Wlfdnj7AP?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

The *future funk* playlist was chosen as the archetype to Lo-fi beats. It is another playlist created by Spotify which collected around 300 000 likes and consist of **100 songs with listening time over 5 hr 42 mins**. Future funk is a genre of music that uses elements of funk, disco and Japanese music with nostalgic influences. It's very upbeat, funky and is usually associated with the aesthetic of '90s anime or consumer culture.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DXbjGYBfEmjR5?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>


Cross-playlist comparison {data-navmenu=Visualisation}
=========================================

Column{data-width=700}
-----------------------------------------

### Cross-playlist comparison

```{r}
chart1 <- soft_lofi |>                    # Soft vs. Lofi.
  mutate(
    instrumentalness = ifelse(instrumentalness == 0, "Low", "High")
  ) |>
  ggplot(                     # Set up the plot.
    aes(
      x = acousticness,
      y = energy,
      size = loudness,
      colour = instrumentalness
    )
  ) +
  geom_point() +              # Scatter plot.
  geom_rug(linewidth = 0.1) + # Add 'fringes' to show data distribution.
  facet_wrap(~ category) +    # Separate charts per playlist.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL     # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(        # Use the Color Brewer to choose a palette.
    type = "qual",            # Qualitative set.
    palette = "Set1"        # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(      # Fine-tune the sizes of each point.
    trans = "exp",            # Use an exp transformation to emphasise loud.            # Remove the legend for size.
  ) +
  theme_light() +             # Use a simpler theme.
  labs(                       # Make the titles nice.
    x = "Acousticness",
    y = "Energy",
    colour = "instrumentalness"
  )

ggplotly(chart1)

```


Column{data-width=300}
-----------------------------------------
In the plot we are contrasting and comparing three playlists. First one is called "Beast Mode" with almost 10,000,000 likes on Spotify and 200 songs. Second goes the "Soft Classical Study" with 1,000 likes and 138 songs. Third goes the "Study Lofi" playlist with 7,000,000 likes and 500 songs. After several experiments and combinations of features the most interesting picture came up with accousticness on x-axis and energy on y-axis. Simultaneously we are looking at the size and color of the dots to see the level of loudness and instrumentalness, respectively. The obvious observations we can make are that first and foremost, study playlist tend to consist of songs with lower energy and higher accousticness. The other two conclusions are pretty much all of the songs in study playlists have high instrumentalness. Last conclusion is that loudness level is low in study playlists and combination of all levels can be observed for the "Beast Mode".
  

Within playlist comparison (chroma features) {data-navmenu=Visualisation}
=========================================

Column{data-width=850 .tabset}
-----------------------------------------

### LOFIüìö

```{r}
chart2 <- compmus_long_distance(
  lofi1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  lofi2 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Forgotten Past by Dosi, Wishes and Dreams", y = "Lofi2") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart2)
chart2
```
  
### CLASSICALüéª

```{r}
chart2 <- compmus_long_distance(
  chopin |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  ludovico |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "'Nocturne in B Major, Op. 62, No. 1' by Chopin", y = "'Nuvole Bianche' by Ludovico Einaudi") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart2)
chart2
```

### WORKOUTüèÜ

```{r}
chart2 <- compmus_long_distance(
  blackpink |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  dualipa |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Pink Venom by Blackpink", y = "Levitating by Dua Lipa") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart2)
chart2
```

### FUTURE FUNKüéá

```{r}
chart2 <- compmus_long_distance(
  futurefunk1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  futurefunk2 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "I Chose Wrong by Chance", y = "Highway Night Lights by Bionsen") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart2)
chart2
```


Column{data-width=150}
-----------------------------------------
Lofi:

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0UCJtleZmlwpicJkmrys4a?utm_source=generator" width="250" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/5yzk0dn1DmFcTkon5JrtTc?utm_source=generator&theme=0" width="250" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

Soft:

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/3weNRklVDqb4Rr5MhKBR3D?utm_source=generator" width="250" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/40pgdwioxZSCUyCke0zzOp?utm_source=generator&theme=0" width="250" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

Workout:

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/5nujrmhLynf4yMoMtj8AQF?utm_source=generator" width="250" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0skYUMpS0AcbpjcGsAbRGj?utm_source=generator" width="250" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

Future funk:

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/2sj2K4VaNNkW17K1yhgrAm?utm_source=generator" width="250" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/6lSrgTxyF9XgyLuNByH7Vm?utm_source=generator" width="250" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>


Cross-playlist comparison (study playlist vs. workout playlist) {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### LOFIüìö vs. CLASSICALüéª

```{r}
chart3 <- compmus_long_distance(
  lofi1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  chopin |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "convo by SNUG", y = "Nocturne B. Major by Chopin") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart3)
chart3
```

### LOFIüìö vs. FUTURE FUNKüéá

```{r}
chart3 <- compmus_long_distance(
  lofi1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  futurefunk1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "convo by SNUG", y = "I Chose Wrong by Chance") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart3)
chart3
```

### CLASSICALüéª vs. WORKOUTüèÜ

```{r}
chart3 <- compmus_long_distance(
  chopin |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  blackpink |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Nocturne B. Major by Chopin", y = "Pink Venom by Blankpink") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart3)
chart3
```

### WORKOUTüèÜ vs. FUTURE FUNKüéá

```{r}
chart3 <- compmus_long_distance(
  futurefunk1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  blackpink |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "I Chose Wrong by Chance", y = "Pink Venom by Blankpink") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
# ggplotly(chart3)
chart3
```


Column{data-width=300}
-----------------------------------------
Description 


Cepstrograms {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### LOFIüìö

```{r}
lofi1 <-
  get_tidy_audio_analysis("5yzk0dn1DmFcTkon5JrtTc?si=61052cc7cd0741dd") |>  # Forgotten Past by Dosi, Wishes and Dreams
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

lofi2 <-
  get_tidy_audio_analysis("6y3y1s6eiTYsLEajJGbCkj?si=2a95b480bd31415c") |> # Cadenza by Lucid Keys, Mondo Loops
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

lofi3 <-
  get_tidy_audio_analysis("0UCJtleZmlwpicJkmrys4a?si=8172fd17c8834ca2") |> # convo by SNUG
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

bind_rows(
lofi1 |>
  compmus_gather_timbre() |>
  mutate(type = "Lofi 1"),
lofi2 |>
  compmus_gather_timbre() |>
  mutate(type = "Lofi 2"),
lofi3 |>
  compmus_gather_timbre() |>
  mutate(type = "Lofi 3")
) |>
  mutate() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value, title(main = 'Lofi - Capturin the Lights')
    )
  ) +
  geom_tile() +
  facet_wrap(~type) +
  scale_fill_viridis_c() +
  theme_classic() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude")
```

### CLASSICALüéª

```{r}
chopin <-
  get_tidy_audio_analysis("40pgdwioxZSCUyCke0zzOp?si=c5c8c0e45dd54c76") |> # "Nocturne in A-Flat Major, Op. 32, No.2" by Chopin
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

ludovico <-
  get_tidy_audio_analysis("3weNRklVDqb4Rr5MhKBR3D?si=c1f8a23072464783") |> # Nuvole Bianche by Ludovico Einaudi
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
joep <-
  get_tidy_audio_analysis("55U56qbqS1g1PaeyIznUjr?si=7da1df14c38c4a3f") |> # Midwayer by Joep Beving
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

bind_rows(
chopin |>
  compmus_gather_timbre() |>
  mutate(type = "Nocturne by Chopin"),
ludovico |>
  compmus_gather_timbre() |>
  mutate(type = "Nuvole Bianche by Ludovico Einaudi"),
joep |>
  compmus_gather_timbre() |>
  mutate(type = "Midwayer by Joep Beving")
) |>
  mutate() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value, title(main = 'Lofi - Capturin the Lights')
    )
  ) +
  geom_tile() +
  facet_wrap(~type) +
  scale_fill_viridis_c() +
  theme_classic() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude")
```

### WORKOUTüèÜ

```{r}
blackpink <-
  get_tidy_audio_analysis("0skYUMpS0AcbpjcGsAbRGj?si=1845018d70214865") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
dualipa <-
  get_tidy_audio_analysis("5nujrmhLynf4yMoMtj8AQF?si=bed60c3fbaa548ee") |> # Nuvole Bianche by Ludovico Einaudi
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
lilnasx <-
  get_tidy_audio_analysis("27NovPIUIRrOZoCHxABJwK?si=937f39f001ac48e8") |> # Midwayer by Joep Beving
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

bind_rows(
blackpink |>
  compmus_gather_timbre() |>
  mutate(type = "Pink Venom by Blackpink"),
dualipa |>
  compmus_gather_timbre() |>
  mutate(type = "Levitating by Dua Lipa"),
lilnasx |>
  compmus_gather_timbre() |>
  mutate(type = "Industry Baby by Lil Nas X and Jack Harlow")
) |>
  mutate() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value, title(main = 'Lofi - Capturin the Lights')
    )
  ) +
  geom_tile() +
  facet_wrap(~type) +
  scale_fill_viridis_c() +
  theme_classic() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude")
```

### FUTURE FUNKüéá

```{r}
futurefunk1 <-
  get_tidy_audio_analysis("6lSrgTxyF9XgyLuNByH7Vm?si=0131824e2ffa4572") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
futurefunk2 <-
  get_tidy_audio_analysis("2sj2K4VaNNkW17K1yhgrAm?si=e62a0008430c481a") |> # Highway Night Lights by Bionsen
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
futurefunk3 <-
  get_tidy_audio_analysis("5raJYLpnYe0fA9aaN5oBv8?si=8e462d63fcf4444d") |> # Feeling different Ajotabeats
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

bind_rows(
futurefunk1 |>
  compmus_gather_timbre() |>
  mutate(type = "I Chose Wrong by Chance"),
futurefunk2 |>
  compmus_gather_timbre() |>
  mutate(type = "Highway Night Lights by Bionsen"),
futurefunk3 |>
  compmus_gather_timbre() |>
  mutate(type = "Feeling Different by Ajotabeats")
) |>
  mutate() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value, title(main = 'Lofi - Capturin the Lights')
    )
  ) +
  geom_tile() +
  facet_wrap(~type) +
  scale_fill_viridis_c() +
  theme_classic() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude")
```

Column{data-width=300}
-----------------------------------------
Lofi:
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0UCJtleZmlwpicJkmrys4a?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/6y3y1s6eiTYsLEajJGbCkj?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/5yzk0dn1DmFcTkon5JrtTc?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
Soft Classical: 
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/55U56qbqS1g1PaeyIznUjr?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/40pgdwioxZSCUyCke0zzOp?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/3weNRklVDqb4Rr5MhKBR3D?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
Workout:
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/27NovPIUIRrOZoCHxABJwK?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/5nujrmhLynf4yMoMtj8AQF?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0skYUMpS0AcbpjcGsAbRGj?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
Future Funk:
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/5raJYLpnYe0fA9aaN5oBv8?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/2sj2K4VaNNkW17K1yhgrAm?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/2sj2K4VaNNkW17K1yhgrAm?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> 


Self Similarity Matrix {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### LOFIüìö

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(spotifyr)
library(compmus)

bind_rows(
  lofi1 |>
    compmus_self_similarity(pitches, "aitchison") |>
    mutate(d = d / max(d), type = "Chroma"),
  lofi1 |>
    compmus_self_similarity(timbre, "euclidean") |>
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```

### CLASSICALüéª

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(spotifyr)
library(compmus)

bind_rows(
  chopin |>
    compmus_self_similarity(pitches, "aitchison") |>
    mutate(d = d / max(d), type = "Chroma"),
  chopin |>
    compmus_self_similarity(timbre, "euclidean") |>
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```


### WORKOUTüèÜ

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(spotifyr)
library(compmus)

bind_rows(
  blackpink |>
    compmus_self_similarity(pitches, "aitchison") |>
    mutate(d = d / max(d), type = "Chroma"),
  blackpink |>
    compmus_self_similarity(timbre, "euclidean") |>
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```


### FUTURE FUNKüéá

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(spotifyr)
library(compmus)

bind_rows(
  futurefunk1 |>
    compmus_self_similarity(pitches, "aitchison") |>
    mutate(d = d / max(d), type = "Chroma"),
  futurefunk1 |>
    compmus_self_similarity(timbre, "euclidean") |>
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```


Column{data-width=300}
-----------------------------------------
Songs:
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0UCJtleZmlwpicJkmrys4a?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/40pgdwioxZSCUyCke0zzOp?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0skYUMpS0AcbpjcGsAbRGj?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/6lSrgTxyF9XgyLuNByH7Vm?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> 


Chordograms {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### LOFIüìö

```{r}
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )

lofi1 |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

### CLASSICALüéª

```{r, echo=FALSE}
chopin |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```

### WORKOUTüèÜ

```{r}
blackpink |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

###  FUTURE FUNKüéá

```{r}
futurefunk1 |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

Column{data-width=300}
-----------------------------------------
Songs:
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0UCJtleZmlwpicJkmrys4a?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/40pgdwioxZSCUyCke0zzOp?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0skYUMpS0AcbpjcGsAbRGj?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/6lSrgTxyF9XgyLuNByH7Vm?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> 

Track Level Summaries {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### Track Level Summaries 1

```{r}
lofi <-
  get_playlist_audio_features(
    "thesoundsofspotify",
    "1IESTA4eaoYhOAi5d0N5Kz?si=e499e373775e4f71"
  ) |>
  slice(1:30) |>
  add_audio_analysis()
soft_classical <-
  get_playlist_audio_features(
    "thesoundsofspotify",
    "63PWggVCDaRoygnVT6zeot?si=69efc4e73940435b"
  ) |>
  slice(1:30) |>
  add_audio_analysis()
workout <-
  get_playlist_audio_features(
    "thesoundsofspotify",
    "66RrIu8zXbf3NiDX07e28Z?si=1cd6a16fe1c84826"
  ) |>
  slice(1:30) |>
  add_audio_analysis()
futurefunk <- get_playlist_audio_features("thesoundsofspotify","5j5HRbB3Qy0GPGVbCrKP2G?si=bf6a2493733c40c5") |>
  slice(1:30) |>
  add_audio_analysis()
study <-
  lofi |>
  mutate(genre = "Lofi") |>
  bind_rows(workout |> mutate(genre = "Workout"), soft_classical |> mutate(genre = "Soft Classical"), futurefunk |> mutate(genre = "Future Funk"))
study |>
  mutate(
    sections =
      map(
        sections,                                    # sections or segments
        summarise_at,
        vars(tempo, loudness, duration),             # features of interest
        list(section_mean = mean, section_sd = sd)   # aggregation functions
      )
  ) |>
  unnest(sections) |>
  ggplot(
    aes(
      x = tempo,
      y = tempo_section_sd,
      colour = genre,
      alpha = loudness
    )
  ) +
  geom_point(aes(size = duration / 60)) +
  geom_rug() +
  theme_minimal() +
  ylim(0, 5) +
  labs(
    x = "Mean Tempo (bpm)",
    y = "SD Tempo",
    colour = "Genre",
    size = "Duration (min)",
    alpha = "Volume (dBFS)"
  )

```

### Track Level Summaries 2

```{r}
chart4 <- study |>
  mutate(
    timbre =
      map(
        segments,
        compmus_summarise,
        timbre,
        method = "mean"
      )
  ) |>
  select(genre, timbre) |>
  compmus_gather_timbre() |>
  ggplot(aes(x = basis, y = value, fill = genre)) +
  geom_violin() +
  scale_fill_viridis_d() +
  labs(x = "Spotify Timbre Coefficients", y = "", fill = "Genre")

ggplotly(chart4)
```

Column{data-width=300}
-----------------------------------------
Description

Clustering - Lofi {data-navmenu=Visualisation}
=========================================
Column{data-width=700 .tabset}
-----------------------------------------

### Lofi - Single
```{r}
lofi_1 <-
  get_playlist_audio_features("", "1IESTA4eaoYhOAi5d0N5Kz?si=e499e373775e4f71") |>
  slice(1:50) |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

lofi_study_s_1 <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = lofi_1
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(lofi_1 |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

study_dist_s <- dist(lofi_study_s_1, method = "euclidean")

study_dist_s |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

heatmaply(
  lofi_study_s_1,
  hclustfun = hclust,
  hclust_method = "single",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
```

### Soft Classical - Single

```{r}
soft <-
  get_playlist_audio_features("", "63PWggVCDaRoygnVT6zeot?si=df0c7418ea6d4dde") |>
  slice(1:50) |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

soft_study_s_1 <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = soft
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(soft |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

soft_dist_s <- dist(soft_study_s_1, method = "euclidean")

soft_dist_s |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

heatmaply(
  soft_study_s_1,
  hclustfun = hclust,
  hclust_method = "single",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
```

### Workout - Single

```{r}
workout <-
  get_playlist_audio_features("", "66RrIu8zXbf3NiDX07e28Z?si=4a602635f1994252") |>
  slice(1:50) |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

workout_study_s_1 <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = workout
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(workout |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

workout_dist_s <- dist(workout_study_s_1, method = "euclidean")

workout_dist_s |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

heatmaply(
  workout_study_s_1,
  hclustfun = hclust,
  hclust_method = "single",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
```

### Future Funk - Single

```{r}
futurefunk <-
  get_playlist_audio_features("", "5j5HRbB3Qy0GPGVbCrKP2G?si=dd861654a8ae4ff2") |>
  slice(1:50) |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

futurefunk_study_s_1 <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = futurefunk
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(futurefunk |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

futurefunk_dist_s <- dist(futurefunk_study_s_1, method = "euclidean")

futurefunk_dist_s |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

heatmaply(
  futurefunk_study_s_1,
  hclustfun = hclust,
  hclust_method = "single",  # Change for single, average, or complete linkage.
  dist_method = "euclidean"
)
```

Column{data-width=300}
-----------------------------------------
Description 

Tempograms {data-navmenu=Visualisation}
=========================================

Column{data-width=700 .tabset}
-----------------------------------------

### LOFIüìö

```{r}
lofi1 <- get_tidy_audio_analysis("5yzk0dn1DmFcTkon5JrtTc?si=61052cc7cd0741dd")   # Forgotten Past by Dosi, Wishes and Dreams
lofi1 |>
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

### CLASSICALüéª

```{r}
chopin <- get_tidy_audio_analysis("40pgdwioxZSCUyCke0zzOp?si=c5c8c0e45dd54c76")   # Forgotten Past by Dosi, Wishes and Dreams
chopin |>
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

### WORKOUTüèÜ 

```{r}
blackpink <- get_tidy_audio_analysis("0skYUMpS0AcbpjcGsAbRGj?si=1845018d70214865")
blackpink |>
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```


### FUTURE FUNKüéá

```{r}
futurefunk1 <- get_tidy_audio_analysis("62jdesXaWtAVtMK75zJn4h?si=d40559b27bd7487a") # "Flashback' by Rhodes Rodosu
futurefunk1 |>
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

Column{data-width=300}
-----------------------------------------
Songs: 
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0UCJtleZmlwpicJkmrys4a?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/40pgdwioxZSCUyCke0zzOp?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/0skYUMpS0AcbpjcGsAbRGj?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/6lSrgTxyF9XgyLuNByH7Vm?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> 

Conclusion{.storyboard}
=========================================
  
### Conclusion 
  
```{r}

```


